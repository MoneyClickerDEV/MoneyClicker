<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clicker â€“ Coins, Upgrades & Boost-Shop</title>
  <style>
    :root {
      --bg:#0f172a; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb;
      --accent:#22c55e; --accent2:#38bdf8; --warn:#f59e0b; --danger:#ef4444;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family:system-ui,Segoe UI,Arial,sans-serif; background:linear-gradient(180deg,#0b1220,#0f172a); color:var(--text); }
    header { padding:16px 20px; border-bottom:1px solid #1f2937; display:flex; align-items:center; justify-content:space-between; gap:16px; position:sticky; top:0; backdrop-filter:saturate(160%) blur(6px); background:#0f172acc; }
    .stats { display:flex; gap:18px; flex-wrap:wrap; align-items:baseline; }
    .stat { font-weight:600; }
    .muted { color: var(--muted); font-weight:500; }
    .mult { color:#f0abfc; font-weight:700; }
    .container { display:grid; grid-template-columns: 1.2fr 1fr 1fr; gap:16px; padding:16px; }
    @media (max-width:1100px){ .container{ grid-template-columns:1fr; } }
    .card { background:var(--panel); border:1px solid #1f2937; border-radius:12px; padding:16px; }
    h2 { margin:0 0 10px 0; font-size:20px; }
    .big-btn { width:100%; padding:26px; font-size:22px; border-radius:12px; border:none; color:#0a0f1e; background:linear-gradient(135deg,#22c55e,#a7f3d0); cursor:pointer; font-weight:800; box-shadow:0 8px 20px #22c55e33; transition:transform .04s ease; }
    .big-btn:active { transform:scale(0.98); }
    .rows { display:grid; gap:10px; }
    .item { display:flex; gap:12px; align-items:center; justify-content:space-between; padding:10px; border:1px solid #1f2937; border-radius:10px; background:#0b1220; }
    .item .info { display:flex; flex-direction:column; gap:4px; }
    .item .title { font-weight:700; }
    .item .desc { color:var(--muted); font-size:13px; }
    .price { font-weight:700; color:var(--accent2); }
    .btn { padding:8px 12px; border-radius:10px; border:1px solid #334155; background:#0f172a; color:#e5e7eb; cursor:pointer; transition:all .1s; }
    .btn.buy { background:linear-gradient(135deg,#38bdf8,#22d3ee); color:#02141d; border:none; font-weight:800; }
    .btn:disabled { opacity:.45; cursor:not-allowed; }
    .pill { display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:#0b1325; border:1px solid #1f2937; font-size:12px; color:#c7d2fe; }
    .boost-list { display:flex; flex-wrap:wrap; gap:8px; }
    .tag { padding:2px 8px; border-radius:999px; background:#111827; color:#93c5fd; border:1px dashed #334155; font-size:12px; }
    footer { padding:12px 16px; color:#94a3b8; font-size:12px; text-align:center; }
    .danger { color: var(--danger); }
  </style>
</head>
<body>
  <header>
    <div class="stats">
      <div class="stat">Coins: <span id="coins">0</span></div>
      <div class="muted">pro Klick: <span id="perClick">1</span></div>
      <div class="muted">pro Sekunde: <span id="perSec">0</span></div>
      <div class="pill">Multiplikator: <span class="mult" id="mult">Ã—1.00</span></div>
    </div>
    <div class="stats">
      <button class="btn" id="saveBtn">Speichern</button>
      <button class="btn" id="resetBtn">ZurÃ¼cksetzen</button>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h2>Klicken</h2>
      <button id="clickBtn" class="big-btn">KLICK! +<span id="clickGain">1</span></button>
      <div style="margin-top:12px" class="boost-list" id="activeBoosts"></div>
    </section>

    <section class="card">
      <h2>Upgrades</h2>
      <div class="rows" id="upgrades"></div>
    </section>

    <section class="card">
      <h2>Boostâ€‘Shop</h2>
      <div class="rows" id="shop"></div>
    </section>
  </main>

  <footer>Speichert automatisch alle 10 Sekunden Â· Boosts laufen weiter, auch wenn die Seite geschlossen wird</footer>

  <script>
    // ---------- State ----------
    const state = {
      coins: 0,
      basePerClick: 1,
      basePerSec: 0,
      upgrades: {
        // coole Namen + klare Effekte
        silverFinger: { level: 0, baseCost: 10, costMul: 1.5, clickGain: 1, name: "Silberfinger", desc: "+1 pro Klick" },
        goldenHammer: { level: 0, baseCost: 75, costMul: 1.55, clickGain: 5, name: "Goldhammer", desc: "+5 pro Klick" },
        quantumTap:   { level: 0, baseCost: 400, costMul: 1.6, clickGain: 15, name: "Quantumâ€‘Tap", desc: "+15 pro Klick" },

        coffeeMachine:{ level: 0, baseCost: 50, costMul: 1.5, secGain: 1, name: "Kaffeemaschine", desc: "+1 pro Sekunde" },
        roboClicker:  { level: 0, baseCost: 300, costMul: 1.55, secGain: 5, name: "Roboklicker", desc: "+5 pro Sekunde" },
        neonFactory:  { level: 0, baseCost: 1200, costMul: 1.6, secGain: 20, name: "Neonâ€‘Fabrik", desc: "+20 pro Sekunde" },
      },
      boosts: [], // { id, name, factor, expiresAt }
      lastTick: Date.now(),
    };

    const shopItems = [
      { id: "x2_1", name: "Doppelschub 1â€¯min", factor: 2, seconds: 60, cost: 200 },
      { id: "x2_5", name: "Doppelschub 5â€¯min", factor: 2, seconds: 300, cost: 800 },
      { id: "x2_10", name: "Doppelschub 10â€¯min", factor: 2, seconds: 600, cost: 1400 },
      { id: "x5_1", name: "FÃ¼nffach 1â€¯min", factor: 5, seconds: 60, cost: 2000 },
      { id: "x5_5", name: "FÃ¼nffach 5â€¯min", factor: 5, seconds: 300, cost: 7000 },
      { id: "x5_10", name: "FÃ¼nffach 10â€¯min", factor: 5, seconds: 600, cost: 12000 },
    ];

    // ---------- Helpers ----------
    const $ = sel => document.querySelector(sel);
    const fmt = n => n >= 1e9 ? (n/1e9).toFixed(2)+"B"
                : n >= 1e6 ? (n/1e6).toFixed(2)+"M"
                : n >= 1e3 ? (n/1e3).toFixed(2)+"k"
                : Math.floor(n).toString();

    function upgradeCost(key) {
      const u = state.upgrades[key];
      return Math.floor(u.baseCost * Math.pow(u.costMul, u.level));
    }

    function totalPerClick() {
      let base = state.basePerClick;
      for (const u of Object.values(state.upgrades)) {
        if (u.clickGain) base += u.level * u.clickGain;
      }
      return Math.max(0, base) * totalMultiplier();
    }

    function totalPerSec() {
      let base = state.basePerSec;
      for (const u of Object.values(state.upgrades)) {
        if (u.secGain) base += u.level * u.secGain;
      }
      return Math.max(0, base) * totalMultiplier();
    }

    function totalMultiplier() {
      if (!state.boosts.length) return 1;
      return state.boosts.reduce((m,b) => m * b.factor, 1);
    }

    function pruneExpiredBoosts() {
      const now = Date.now();
      const before = state.boosts.length;
      state.boosts = state.boosts.filter(b => b.expiresAt > now);
      if (state.boosts.length !== before) renderActiveBoosts();
    }

    function addCoins(amount) {
      state.coins += amount;
      if (!Number.isFinite(state.coins)) state.coins = 0;
    }

    // ---------- UI ----------
    function renderHeader() {
      $("#coins").textContent = fmt(state.coins);
      $("#perClick").textContent = fmt(totalPerClick());
      $("#perSec").textContent = fmt(totalPerSec());
      $("#mult").textContent = "Ã—" + totalMultiplier().toFixed(2);
      $("#clickGain").textContent = fmt(totalPerClick());
    }

    function renderUpgrades() {
      const el = $("#upgrades"); el.innerHTML = "";
      for (const [key,u] of Object.entries(state.upgrades)) {
        const cost = upgradeCost(key);
        const can = state.coins >= cost;
        const row = document.createElement("div");
        row.className = "item";
        row.innerHTML = `
          <div class="info">
            <div class="title">${u.name} <span class="tag">Lvl ${u.level}</span></div>
            <div class="desc">${u.desc}</div>
          </div>
          <div style="display:flex; align-items:center; gap:10px">
            <div class="price">ðŸ’° ${fmt(cost)}</div>
            <button class="btn buy" ${!can ? "disabled" : ""} data-upg="${key}">Kaufen</button>
          </div>
        `;
        row.querySelector("button").addEventListener("click", () => buyUpgrade(key));
        el.appendChild(row);
      }
    }

    function renderShop() {
      const el = $("#shop"); el.innerHTML = "";
      for (const it of shopItems) {
        const can = state.coins >= it.cost;
        const row = document.createElement("div");
        row.className = "item";
        row.innerHTML = `
          <div class="info">
            <div class="title">${it.name} <span class="tag">Ã—${it.factor}</span></div>
            <div class="desc">Wirkt ${Math.floor(it.seconds/60)} min Â· Stapelt sich multiplikativ</div>
          </div>
          <div style="display:flex; align-items:center; gap:10px">
            <div class="price">ðŸ’° ${fmt(it.cost)}</div>
            <button class="btn buy" ${!can ? "disabled" : ""} data-boost="${it.id}">Kaufen</button>
          </div>
        `;
        row.querySelector("button").addEventListener("click", () => buyBoost(it.id));
        el.appendChild(row);
      }
    }

    function renderActiveBoosts() {
      const el = $("#activeBoosts"); el.innerHTML = "";
      if (!state.boosts.length) {
        const span = document.createElement("span");
        span.className = "muted";
        span.textContent = "Keine aktiven Boosts";
        el.appendChild(span);
        return;
      }
      for (const b of state.boosts) {
        const left = Math.max(0, b.expiresAt - Date.now());
        const m = Math.floor(left/60000), s = Math.floor((left%60000)/1000);
        const pill = document.createElement("div");
        pill.className = "pill";
        pill.textContent = `${b.name} Ã—${b.factor} Â· ${m}:${s.toString().padStart(2,"0")}`;
        el.appendChild(pill);
      }
    }

    function renderAll() {
      renderHeader();
      renderUpgrades();
      renderShop();
      renderActiveBoosts();
      updateButtonsEnabled();
    }

    function updateButtonsEnabled() {
      // enable/disable buys according to coins
      document.querySelectorAll("[data-upg]").forEach(btn => {
        const key = btn.getAttribute("data-upg");
        btn.disabled = state.coins < upgradeCost(key);
      });
      document.querySelectorAll("[data-boost]").forEach(btn => {
        const item = shopItems.find(i => i.id === btn.getAttribute("data-boost"));
        btn.disabled = !item || state.coins < item.cost;
      });
    }

    // ---------- Actions ----------
    function buyUpgrade(key) {
      const cost = upgradeCost(key);
      if (state.coins < cost) return;
      addCoins(-cost);
      state.upgrades[key].level++;
      save();
      renderAll();
    }

    function buyBoost(id) {
      const it = shopItems.find(i => i.id === id);
      if (!it || state.coins < it.cost) return;
      addCoins(-it.cost);
      const expiresAt = Date.now() + it.seconds * 1000;
      state.boosts.push({ id, name: it.name, factor: it.factor, expiresAt });
      save();
      renderHeader();
      renderShop();
      renderActiveBoosts();
    }

    // ---------- Persistence ----------
    const SAVE_KEY = "clickerSave_v1";

    function save() {
      const data = {
        coins: state.coins,
        upgrades: Object.fromEntries(Object.entries(state.upgrades).map(([k,u]) => [k, u.level])),
        boosts: state.boosts,
        basePerClick: state.basePerClick,
        basePerSec: state.basePerSec,
        lastSave: Date.now(),
      };
      localStorage.setItem(SAVE_KEY, JSON.stringify(data));
    }

    function load() {
      const raw = localStorage.getItem(SAVE_KEY);
      if (!raw) return;
      try {
        const data = JSON.parse(raw);
        if (typeof data.coins === "number") state.coins = data.coins;
        if (data.basePerClick) state.basePerClick = data.basePerClick;
        if (data.basePerSec) state.basePerSec = data.basePerSec;
        if (data.upgrades) {
          for (const [k,lvl] of Object.entries(data.upgrades)) {
            if (state.upgrades[k]) state.upgrades[k].level = lvl|0;
          }
        }
        if (Array.isArray(data.boosts)) {
          // filter abgelaufene Boosts
          const now = Date.now();
          state.boosts = data.boosts.filter(b => b.expiresAt > now);
        }
      } catch(e) {
        console.warn("Load failed", e);
      }
    }

    // ---------- Loop ----------
    function tick() {
      const now = Date.now();
      const dt = now - state.lastTick; // ms
      state.lastTick = now;

      pruneExpiredBoosts();

      const perSec = totalPerSec();
      if (perSec > 0) {
        addCoins(perSec * (dt/1000));
      }

      renderHeader();
      renderActiveBoosts();
      updateButtonsEnabled();
    }

    // ---------- Wire up ----------
    $("#clickBtn").addEventListener("click", () => {
      addCoins(totalPerClick());
      renderHeader();
      updateButtonsEnabled();
    });

    $("#saveBtn").addEventListener("click", () => { save(); renderHeader(); });

    $("#resetBtn").addEventListener("click", () => {
      if (!confirm("Wirklich alles zurÃ¼cksetzen?")) return;
      localStorage.removeItem(SAVE_KEY);
      location.reload();
    });

    // init
    load();
    renderAll();
    state.lastTick = Date.now();
    setInterval(tick, 250);
    setInterval(() => save(), 10000);
  </script>
</body>
</html>